<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Mes Courses">
  <title>Mes Courses - Gigi</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIk1lcyBDb3Vyc2VzIiwKICAic2hvcnRfbmFtZSI6ICJDb3Vyc2VzIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmZmZmZmYiLAogICJ0aGVtZV9jb2xvciI6ICIjNDc3MEZGIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTWpBd0lpQm9aV2xuYUhROUlqSXdNQ0lnZG1sbGQwSnZlRDBpTUNBd0lESXdNQ0F5TURBaUlHWnBiR3c5SW01dmJtVWlJSGh0Ykc1eklEMGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lQZ29nSUR4d1lYUm9JR1E5SWswMU1DQTBNRU0xTUNBek5TQTFOU0F6TUNBMk1DQXpNRXd4TkRBZ016QkRNVFExSURNd0lERTFNQ0F6TlNBeE5UQWdOREJNTVRVd0lEY3dURFV3SURjd1BRUNFLWG5Zd0lqOThQR1ZzYkdsd2MyVWdZM2c5SWpFd01DSWdZM2s5SWpjd0lpQnllRDBpTlRBaUlISjVQU0l6TlNJZ1ptbHNiRDBpSXpZQ09FVTFSQ0l2UGdvZ1BIQmhkR2dnWkQwaVRUY3dJRGcxVERjd0lERXdOVU0zTUNBeE1EVWdOelVnTVRBd0lEZ3dJREV3TUVNNE5TQXhNREFnT0RVZ01UQTFJRGcxSURFd05VdzROQ0E0TlNJZ2MzUnliMnRsUFNJak1VVXpRVFEzSWlCemRISnZhMlZYYVdSMGFEMGlOU0lnYzNSeWIydGxUR2x1WldOaGNEMGljbTkxYm1RaUlHWnBiR3c5SW01dmJtVWlMejRLSUR4d1lYUm9JR1E5SWswNU5TQXhNalVnVVRrM0lERXlPQ0F4TURBZ01USTRJRkV4TURNZ01USTRJREV3TlNBeE1qVWlJSE4wY205clpUMGlJekZGTTBFME55SWdjM1J5YjJ0bFYybGtkR2c5SWpNaUlHWnBiR3c5SW01dmJtVWlMejRLUEM5emRtYysiLAogICAgICAic2l6ZXMiOiAiNTEyeDUxMiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    #root {
      min-height: 100vh;
    }
  </style>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel Standalone -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, createElement } = React;

    // Icônes SVG simplifiées
    const Icons = {
      Plus: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
      Store: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
      ShoppingCart: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>,
      Edit2: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>,
      Trash2: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
      X: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ChevronRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="9 18 15 12 9 6"/></svg>,
      ArrowUp: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg>,
      ArrowDown: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><polyline points="19 12 12 19 5 12"/></svg>,
      Apple: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z"/><path d="M10 2c1 .5 2 2 2 5"/></svg>,
      Beef: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6.5 6.5h11v11h-11z"/><path d="M6 6L5 5M18 6l1-1M6 18l-1 1M18 18l1 1"/></svg>,
      Fish: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6.5 12c.94-3.46 4.94-6 8.5-6 3.56 0 6.06 2.54 7 6-.94 3.47-3.44 6-7 6s-7.56-2.53-8.5-6Z"/><path d="M18 12v.5M16 17.5a10 10 0 0 1-8-5 10 10 0 0 1 8-5"/></svg>,
      Milk: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M8 2h8v2.5l1 1.5v15h-10v-15l1-1.5z"/><path d="M9 6h6"/></svg>,
      Coffee: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>,
      Cookie: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="1"/><circle cx="9" cy="9" r="1"/><circle cx="15" cy="9" r="1"/><circle cx="9" cy="15" r="1"/><circle cx="15" cy="15" r="1"/></svg>,
      Snowflake: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="2" x2="12" y2="22"/><path d="m17 5-5 5-5-5"/><path d="m17 19-5-5-5 5"/><path d="M2 12h20"/><path d="m5 7 5 5-5 5"/><path d="m19 7-5 5 5 5"/></svg>,
      Beer: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 11h1a3 3 0 0 1 0 6h-1"/><path d="M9 12v6"/><path d="M13 12v6"/><path d="M14 7.5c-1 0-1.44.5-3 .5s-2-.5-3-.5-1.72.5-2.5.5a2.5 2.5 0 0 1 0-5c.78 0 1.57.5 2.5.5S9.44 2 11 2s2 1.5 3 1.5 1.72-.5 2.5-.5a2.5 2.5 0 0 1 0 5c-.78 0-1.5-.5-2.5-.5Z"/><path d="M5 8v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V8"/></svg>,
      Droplet: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>,
      Sparkles: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>,
      Package: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>,
    };

    const AISLE_ICONS = {
      'Fruits et Légumes': 'Apple',
      'Boucherie': 'Beef',
      'Poissonnerie': 'Fish',
      'Crémerie': 'Milk',
      'Épicerie Salée': 'Coffee',
      'Épicerie Sucrée': 'Cookie',
      'Surgelés': 'Snowflake',
      'Boissons': 'Beer',
      'Hygiène': 'Droplet',
      'Entretien': 'Sparkles'
    };

    function ShoppingListApp() {
      const [stores, setStores] = useState([]);
      const [products, setProducts] = useState([]);
      const [aisles, setAisles] = useState(['Fruits et Légumes', 'Boucherie', 'Poissonnerie', 'Crémerie', 'Épicerie Salée', 'Épicerie Sucrée', 'Surgelés', 'Boissons', 'Hygiène', 'Entretien']);
      const [lists, setLists] = useState([]);
      const [view, setView] = useState('home');
      const [currentStore, setCurrentStore] = useState(null);
      const [currentList, setCurrentList] = useState(null);
      const [editingStore, setEditingStore] = useState(null);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        const savedStores = localStorage.getItem('stores');
        const savedProducts = localStorage.getItem('products');
        const savedAisles = localStorage.getItem('aisles');
        const savedLists = localStorage.getItem('lists');
        
        if (savedStores) setStores(JSON.parse(savedStores));
        if (savedProducts) setProducts(JSON.parse(savedProducts));
        if (savedAisles) setAisles(JSON.parse(savedAisles));
        if (savedLists) setLists(JSON.parse(savedLists));
        
        setLoading(false);
      }, []);

      useEffect(() => { if (!loading) localStorage.setItem('stores', JSON.stringify(stores)); }, [stores, loading]);
      useEffect(() => { if (!loading) localStorage.setItem('products', JSON.stringify(products)); }, [products, loading]);
      useEffect(() => { if (!loading && aisles.length > 0) localStorage.setItem('aisles', JSON.stringify(aisles)); }, [aisles, loading]);
      useEffect(() => { if (!loading) localStorage.setItem('lists', JSON.stringify(lists)); }, [lists, loading]);

      const getAisleIcon = (aisleName) => {
        const iconName = AISLE_ICONS[aisleName] || 'Store';
        const IconComponent = Icons[iconName];
        return IconComponent ? <IconComponent /> : <Icons.Store />;
      };

      const addStore = (name, selectedAisles) => {
        const newStore = { id: Date.now(), name, aisles: selectedAisles };
        setStores([...stores, newStore]);
        setView('home');
      };

      const deleteStore = (storeId) => {
        if (window.confirm('Êtes-vous sûr de vouloir supprimer ce magasin ?')) {
          setStores(stores.filter(s => s.id !== storeId));
          // Supprimer aussi les listes associées à ce magasin
          setLists(lists.filter(l => l.storeId !== storeId));
        }
      };

      const updateStore = (storeId, name, selectedAisles) => {
        setStores(stores.map(s => s.id === storeId ? { ...s, name, aisles: selectedAisles } : s));
        setEditingStore(null);
        setView('home');
      };

      const addProduct = (name, aisle) => {
        const newProduct = { id: Date.now(), name, aisle };
        setProducts([...products, newProduct]);
      };

      const deleteProduct = (productId) => {
        if (window.confirm('Supprimer ce produit ?')) {
          setProducts(products.filter(p => p.id !== productId));
        }
      };

      if (loading) return <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center"><div className="text-gray-600">Chargement...</div></div>;

      if (view === 'home') return <HomeView />;
      if (view === 'add-store') return <AddStoreView />;
      if (view === 'edit-store') return <EditStoreView />;
      if (view === 'create-list') return <CreateListView />;
      if (view === 'view-list') return <ViewListView />;
      if (view === 'manage-products') return <ManageProductsView />;

      function HomeView() {
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 pb-8">
            <div className="max-w-2xl mx-auto">
              <div className="text-center mb-8 pt-6">
                <h1 className="text-3xl font-bold text-gray-800 mb-2">Mes Courses</h1>
                <p className="text-gray-600">Organisez vos achats facilement</p>
              </div>

              <div className="space-y-4 mb-6">
                <button onClick={() => setView('add-store')} className="w-full bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition flex items-center justify-between group">
                  <div className="flex items-center gap-3">
                    <div className="bg-blue-100 p-2 rounded-lg group-hover:bg-blue-200 transition"><Icons.Store /></div>
                    <span className="font-medium text-gray-800">Ajouter un magasin</span>
                  </div>
                  <Icons.Plus />
                </button>
                
                <button onClick={() => setView('manage-products')} className="w-full bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition flex items-center justify-between group">
                  <div className="flex items-center gap-3">
                    <div className="bg-purple-100 p-2 rounded-lg group-hover:bg-purple-200 transition"><Icons.Package /></div>
                    <span className="font-medium text-gray-800">Gérer mes articles</span>
                  </div>
                  <Icons.ChevronRight />
                </button>
              </div>

              {stores.length > 0 && (
                <div className="mb-6">
                  <h2 className="text-lg font-semibold text-gray-700 mb-3">Mes magasins</h2>
                  <div className="space-y-3">
                    {stores.map(store => (
                      <div key={store.id} className="bg-white rounded-xl p-4 shadow-sm">
                        <div className="flex items-center justify-between mb-2">
                          <h3 className="font-medium text-gray-800">{store.name}</h3>
                          <div className="flex gap-2">
                            <button onClick={() => { setEditingStore(store); setView('edit-store'); }} className="text-blue-600 hover:text-blue-700"><Icons.Edit2 /></button>
                            <button onClick={() => deleteStore(store.id)} className="text-red-500 hover:text-red-700"><Icons.Trash2 /></button>
                          </div>
                        </div>
                        <p className="text-sm text-gray-500 mb-3">{store.aisles.length} rayons</p>
                        <button onClick={() => { setCurrentStore(store); setView('create-list'); }} className="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition font-medium flex items-center justify-center gap-2">
                          <Icons.ShoppingCart />
                          Créer une liste
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {lists.length > 0 && (
                <div>
                  <h2 className="text-lg font-semibold text-gray-700 mb-3">Mes listes</h2>
                  <div className="space-y-3">
                    {lists.map(list => {
                      const checked = list.items.filter(i => i.checked).length;
                      const total = list.items.length;
                      const progress = (checked / total) * 100;
                      return (
                        <button key={list.id} onClick={() => { setCurrentList(list); setView('view-list'); }} className="w-full bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition text-left">
                          <div className="flex justify-between items-start mb-2">
                            <div>
                              <h3 className="font-medium text-gray-800">{list.storeName}</h3>
                              <p className="text-sm text-gray-500">{list.date}</p>
                            </div>
                            <span className="text-sm font-medium text-gray-600">{checked}/{total}</span>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-2">
                            <div className="bg-green-600 h-2 rounded-full transition-all" style={{ width: `${progress}%` }}></div>
                          </div>
                        </button>
                      );
                    })}
                  </div>
                </div>
              )}
            </div>
          </div>
        );
      }

      function AddStoreView() {
        const [name, setName] = useState('');
        const [selectedAisles, setSelectedAisles] = useState([]);

        const toggleAisle = (aisle) => {
          setSelectedAisles(prev => prev.includes(aisle) ? prev.filter(a => a !== aisle) : [...prev, aisle]);
        };

        const handleSubmit = () => {
          if (name.trim() && selectedAisles.length > 0) {
            addStore(name, selectedAisles);
          }
        };

        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 pb-8">
            <div className="max-w-2xl mx-auto">
              <div className="flex items-center justify-between mb-6">
                <h1 className="text-2xl font-bold text-gray-800">Nouveau magasin</h1>
                <button onClick={() => setView('home')} className="text-gray-600 hover:text-gray-800"><Icons.X /></button>
              </div>
              <div className="space-y-4">
                <div className="bg-white rounded-xl p-6 shadow-sm">
                  <label className="block text-sm font-medium text-gray-700 mb-2">Nom du magasin</label>
                  <input type="text" value={name} onChange={(e) => setName(e.target.value)} placeholder="Ex: Leclerc Centre-ville" className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                </div>
                <div className="bg-white rounded-xl p-6 shadow-sm">
                  <label className="block text-sm font-medium text-gray-700 mb-3">Sélectionner les rayons</label>
                  <div className="space-y-2">
                    {aisles.map(aisle => (
                      <label key={aisle} className="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 cursor-pointer">
                        <input type="checkbox" checked={selectedAisles.includes(aisle)} onChange={() => toggleAisle(aisle)} className="w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500" />
                        <span className="text-blue-600">{getAisleIcon(aisle)}</span>
                        <span className="text-gray-700">{aisle}</span>
                      </label>
                    ))}
                  </div>
                </div>
                <button onClick={handleSubmit} disabled={!name.trim() || selectedAisles.length === 0} className="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition disabled:bg-gray-300 disabled:cursor-not-allowed shadow-sm">
                  Créer le magasin
                </button>
              </div>
            </div>
          </div>
        );
      }

      function EditStoreView() {
        const [name, setName] = useState(editingStore.name);
        const [selectedAisles, setSelectedAisles] = useState(editingStore.aisles);

        const toggleAisle = (aisle) => {
          setSelectedAisles(prev => prev.includes(aisle) ? prev.filter(a => a !== aisle) : [...prev, aisle]);
        };

        const handleSubmit = () => {
          if (name.trim() && selectedAisles.length > 0) {
            updateStore(editingStore.id, name, selectedAisles);
          }
        };

        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 pb-8">
            <div className="max-w-2xl mx-auto">
              <div className="flex items-center justify-between mb-6">
                <h1 className="text-2xl font-bold text-gray-800">Modifier le magasin</h1>
                <button onClick={() => { setEditingStore(null); setView('home'); }} className="text-gray-600 hover:text-gray-800"><Icons.X /></button>
              </div>
              <div className="space-y-4">
                <div className="bg-white rounded-xl p-6 shadow-sm">
                  <label className="block text-sm font-medium text-gray-700 mb-2">Nom du magasin</label>
                  <input type="text" value={name} onChange={(e) => setName(e.target.value)} className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                </div>
                <div className="bg-white rounded-xl p-6 shadow-sm">
                  <label className="block text-sm font-medium text-gray-700 mb-3">Sélectionner les rayons</label>
                  <div className="space-y-2">
                    {aisles.map(aisle => (
                      <label key={aisle} className="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 cursor-pointer">
                        <input type="checkbox" checked={selectedAisles.includes(aisle)} onChange={() => toggleAisle(aisle)} className="w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500" />
                        <span className="text-blue-600">{getAisleIcon(aisle)}</span>
                        <span className="text-gray-700">{aisle}</span>
                      </label>
                    ))}
                  </div>
                </div>
                <button onClick={handleSubmit} disabled={!name.trim() || selectedAisles.length === 0} className="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition disabled:bg-gray-300 disabled:cursor-not-allowed shadow-sm">
                  Enregistrer
                </button>
              </div>
            </div>
          </div>
        );
      }

      function CreateListView() {
        const [search, setSearch] = useState('');
        const [listItems, setListItems] = useState([]);
        const [showNewProduct, setShowNewProduct] = useState(false);
        const [selectedAisle, setSelectedAisle] = useState('');

        const storeProducts = products.filter(p => currentStore.aisles.includes(p.aisle));
        const filteredProducts = storeProducts.filter(p => p.name.toLowerCase().includes(search.toLowerCase()));

        const addItem = (product) => {
          if (!listItems.find(item => item.product === product.name)) {
            setListItems([...listItems, { product: product.name, aisle: product.aisle, checked: false }]);
          }
          setSearch('');
        };

        const addNewProduct = () => {
          if (search.trim() && selectedAisle) {
            addProduct(search.trim(), selectedAisle);
            // FIX: Ajouter à la liste existante au lieu de réinitialiser
            setListItems([...listItems, { product: search.trim(), aisle: selectedAisle, checked: false }]);
            setSearch('');
            setSelectedAisle('');
            setShowNewProduct(false);
          }
        };

        const removeItem = (index) => {
          setListItems(listItems.filter((_, i) => i !== index));
        };

        const saveList = () => {
          if (listItems.length > 0) {
            const newList = {
              id: Date.now(),
              storeId: currentStore.id,
              storeName: currentStore.name,
              date: new Date().toLocaleDateString('fr-FR'),
              items: listItems
            };
            setLists([...lists, newList]);
            setCurrentStore(null);
            setView('home');
          }
        };

        const exactMatch = storeProducts.find(p => p.name.toLowerCase() === search.toLowerCase());
        const hasResults = search && filteredProducts.length > 0;
        const noResults = search && filteredProducts.length === 0 && !exactMatch;

        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 pb-8">
            <div className="max-w-2xl mx-auto">
              <div className="flex items-center justify-between mb-6">
                <div>
                  <h1 className="text-2xl font-bold text-gray-800">{currentStore.name}</h1>
                  <p className="text-sm text-gray-600">Créer une nouvelle liste</p>
                </div>
                <button onClick={() => { setCurrentStore(null); setView('home'); }} className="text-gray-600 hover:text-gray-800"><Icons.X /></button>
              </div>
              <div className="space-y-4">
                <div className="bg-white rounded-xl p-6 shadow-sm">
                  <input type="text" value={search} onChange={(e) => { setSearch(e.target.value); setShowNewProduct(false); }} placeholder="Rechercher un produit..." className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 mb-3" />
                  {hasResults && (
                    <div className="space-y-2">
                      {filteredProducts.slice(0, 5).map(product => (
                        <button key={product.id} onClick={() => addItem(product)} className="w-full text-left p-3 hover:bg-gray-50 rounded-lg flex items-center justify-between group">
                          <div className="flex items-center gap-2">
                            <span className="text-gray-500">{getAisleIcon(product.aisle)}</span>
                            <div>
                              <div className="text-gray-800">{product.name}</div>
                              <div className="text-sm text-gray-500">{product.aisle}</div>
                            </div>
                          </div>
                          <Icons.Plus />
                        </button>
                      ))}
                    </div>
                  )}
                  {noResults && !showNewProduct && (
                    <button onClick={() => setShowNewProduct(true)} className="w-full p-3 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition">
                      Créer "{search}"
                    </button>
                  )}
                  {showNewProduct && (
                    <div className="mt-3 p-4 bg-amber-50 rounded-lg border border-amber-200">
                      <p className="text-sm text-gray-700 mb-3">Produit non trouvé. Sélectionnez un rayon :</p>
                      <select value={selectedAisle} onChange={(e) => setSelectedAisle(e.target.value)} className="w-full px-4 py-2 border border-gray-300 rounded-lg mb-2">
                        <option value="">Choisir un rayon</option>
                        {currentStore.aisles.map(aisle => <option key={aisle} value={aisle}>{aisle}</option>)}
                      </select>
                      <button onClick={addNewProduct} className="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition">Créer et ajouter</button>
                    </div>
                  )}
                </div>
                {listItems.length > 0 && (
                  <div className="bg-white rounded-xl p-6 shadow-sm mb-4">
                    <h3 className="font-medium text-gray-700 mb-3">Produits ({listItems.length})</h3>
                    <div className="space-y-2">
                      {listItems.map((item, index) => (
                        <div key={index} className="flex items-center justify-between bg-gray-50 p-3 rounded-lg">
                          <div className="flex items-center gap-2 flex-1">
                            <span className="text-gray-500">{getAisleIcon(item.aisle)}</span>
                            <div>
                              <div className="font-medium text-gray-800">{item.product}</div>
                              <div className="text-sm text-gray-500">{item.aisle}</div>
                            </div>
                          </div>
                          <button onClick={() => removeItem(index)} className="text-red-500 hover:text-red-700"><Icons.Trash2 /></button>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
                {listItems.length > 0 && (
                  <button onClick={saveList} className="w-full bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700 transition shadow-sm">Créer la liste</button>
                )}
              </div>
            </div>
          </div>
        );
      }

      function ViewListView() {
        const toggleItem = (index) => {
          const updatedItems = [...currentList.items];
          updatedItems[index].checked = !updatedItems[index].checked;
          const updatedList = { ...currentList, items: updatedItems };
          setLists(lists.map(l => l.id === currentList.id ? updatedList : l));
          setCurrentList(updatedList);
        };

        const deleteList = () => {
          if (window.confirm('Supprimer cette liste ?')) {
            const listId = currentList.id;
            setLists(prevLists => prevLists.filter(l => l.id !== listId));
            setCurrentList(null);
            setView('home');
          }
        };

        const allChecked = currentList.items.every(item => item.checked) && currentList.items.length > 0;
        const groupedItems = {};
        currentList.items.forEach(item => {
          if (!groupedItems[item.aisle]) groupedItems[item.aisle] = [];
          groupedItems[item.aisle].push(item);
        });

        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 pb-8">
            <div className="max-w-2xl mx-auto">
              <div className="flex justify-between items-center mb-6">
                <div>
                  <h1 className="text-2xl font-bold text-gray-800">{currentList.storeName}</h1>
                  <p className="text-sm text-gray-600">{currentList.date}</p>
                </div>
                <button onClick={() => setView('home')} className="text-gray-600 hover:text-gray-800"><Icons.X /></button>
              </div>
              {allChecked && (
                <div className="bg-green-50 border-2 border-green-500 rounded-xl p-4 mb-4 text-center">
                  <p className="text-green-800 font-medium mb-3">🎉 Liste terminée !</p>
                  <button onClick={deleteList} className="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition">Supprimer la liste</button>
                </div>
              )}
              <div className="space-y-4">
                {Object.entries(groupedItems).map(([aisle, items]) => (
                  <div key={aisle} className="bg-white rounded-xl p-5 shadow-sm">
                    <h3 className="font-semibold text-gray-700 mb-3 pb-2 border-b border-gray-200 flex items-center gap-2">
                      <span className="text-indigo-600">{getAisleIcon(aisle)}</span>
                      {aisle}
                    </h3>
                    <div className="space-y-2">
                      {items.map((item) => {
                        const globalIndex = currentList.items.indexOf(item);
                        return (
                          <label key={globalIndex} className="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="checkbox" checked={item.checked} onChange={() => toggleItem(globalIndex)} className="w-5 h-5 text-green-600 rounded focus:ring-2 focus:ring-green-500" />
                            <span className={`flex-1 ${item.checked ? 'line-through text-gray-400' : 'text-gray-800'}`}>{item.product}</span>
                          </label>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
              <button onClick={deleteList} className="w-full mt-6 bg-red-500 text-white py-3 rounded-lg font-medium hover:bg-red-600 transition shadow-sm flex items-center justify-center gap-2">
                <Icons.Trash2 />
                Supprimer la liste
              </button>
            </div>
          </div>
        );
      }

      function ManageProductsView() {
        const groupedProducts = {};
        products.forEach(product => {
          if (!groupedProducts[product.aisle]) {
            groupedProducts[product.aisle] = [];
          }
          groupedProducts[product.aisle].push(product);
        });

        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 pb-8">
            <div className="max-w-2xl mx-auto">
              <div className="flex items-center justify-between mb-6">
                <h1 className="text-2xl font-bold text-gray-800">Mes articles</h1>
                <button onClick={() => setView('home')} className="text-gray-600 hover:text-gray-800"><Icons.X /></button>
              </div>

              {products.length === 0 ? (
                <div className="bg-white rounded-xl p-8 shadow-sm text-center">
                  <div className="text-gray-400 mb-3"><Icons.Package /></div>
                  <p className="text-gray-600">Aucun article enregistré</p>
                  <p className="text-sm text-gray-500 mt-2">Les articles seront créés automatiquement lors de vos listes de courses</p>
                </div>
              ) : (
                <div className="space-y-4">
                  <div className="bg-blue-50 border border-blue-200 rounded-xl p-4">
                    <p className="text-sm text-blue-800">
                      <strong>{products.length}</strong> articles enregistrés
                    </p>
                  </div>

                  {Object.entries(groupedProducts).sort((a, b) => a[0].localeCompare(b[0])).map(([aisle, aisleProducts]) => (
                    <div key={aisle} className="bg-white rounded-xl p-5 shadow-sm">
                      <h3 className="font-semibold text-gray-700 mb-3 pb-2 border-b border-gray-200 flex items-center gap-2">
                        <span className="text-indigo-600">{getAisleIcon(aisle)}</span>
                        {aisle}
                        <span className="ml-auto text-sm font-normal text-gray-500">({aisleProducts.length})</span>
                      </h3>
                      <div className="space-y-2">
                        {aisleProducts.sort((a, b) => a.name.localeCompare(b.name)).map(product => (
                          <div key={product.id} className="flex items-center justify-between p-3 rounded-lg hover:bg-gray-50">
                            <span className="text-gray-800">{product.name}</span>
                            <button onClick={() => deleteProduct(product.id)} className="text-red-500 hover:text-red-700 transition">
                              <Icons.Trash2 />
                            </button>
                          </div>
                        ))}
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        );
      }

      return null;
    }

    ReactDOM.render(<ShoppingListApp />, document.getElementById('root'));
  </script>
</body>
</html>
